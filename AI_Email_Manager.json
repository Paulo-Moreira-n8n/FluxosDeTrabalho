{
  "name": "AI-Email Manager",
  "nodes": [
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "filters": {}
      },
      "id": "1cdc2008-defd-4da4-b252-52613438a073",
      "name": "Gmail Trigger",
      "type": "n8n-nodes-base.gmailTrigger",
      "position": [
        840,
        300
      ],
      "typeVersion": 1.2,
      "credentials": {
        "gmailOAuth2": {
          "id": "2h2s2AVV8GDAHrDN",
          "name": "Autentica√ß√£o na API do Google Gmail"
        }
      }
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n\t\"label\": \"Label name\", \n\"label ID\": \"label ID\" \n}"
      },
      "id": "1cf756fa-03eb-4fba-b82a-3d6a3dbe8cc4",
      "name": "Structured Output Parser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "position": [
        1820,
        600
      ],
      "typeVersion": 1.2
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "claude-sonnet-4-20250514",
          "cachedResultName": "Claude Sonnet 4"
        },
        "options": {}
      },
      "id": "557aa035-f828-4668-b260-1fd33c225b80",
      "name": "Anthropic Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "position": [
        1260,
        600
      ],
      "typeVersion": 1.3,
      "credentials": {
        "anthropicApi": {
          "id": "wlYZvQS9Wma0pGTh",
          "name": "Autentica√ß√£o na API do Anthropic"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "Run the task.",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=**Objetivo:** Analisar os dados de e-mail fornecidos e classific√°-los com o r√≥tulo mais apropriado. **Utilizar a funcionalidade de verificar o hist√≥rico de e-mails anteriores (e-mails enviados ou recebidos do remetente por `paulo.moreira.n8n@gmail.com`)** para determinar se esta √© uma primeira intera√ß√£o (e-mail frio) ou parte de um relacionamento existente. Este contexto √© crucial para uma rotulagem precisa, especialmente para distinguir entre Marketing, Notifica√ß√µes e FYI. Responda com *apenas* o ID do R√≥tulo correspondente.\n\n**Seu endere√ßo de e-mail (para contexto):** `paulo.moreira.n8n@gmail.com`\n\n**Principais recursos (a serem usados ‚Äã‚Äãpelo sistema que executa este prompt):**\n* **Verificar hist√≥rico de e-mails anteriores:** Antes da classifica√ß√£o completa, determine se existe alguma correspond√™ncia de e-mail anterior entre `paulo.moreira.n8n@gmail.com` e `{{ $json.from.value[0].address }}`. Esta verifica√ß√£o deve resultar em \"Sim\" (hist√≥rico existente) ou \"N√£o\" (nenhum hist√≥rico encontrado).\n\n**Dados de e-mail de entrada (do item JSON n8n para o e-mail *atual*):**\n* **E-mail do Remetente:** `{{ $json.from.value[0].address }}`\n* **Nome do Remetente:** `{{ $json.from.value[0].name }}`\n* **E-mails de Destinat√°rios Diretos (para):** `{{ $json.to.value.map(r => r.address).join(', ') }}`\n* **E-mails de Destinat√°rios CC:** `{{ $json.cc.value.map(r => r.address).join(', ') }}` *(Adicionei isso com base no seu JSON, use se preenchido)*\n* **Assunto:** `{{ $json.subject }}`\n* **Corpo (Texto Simples):** `{{ $json.text }}`\n* **Marcadores Existentes do Gmail (para o e-mail atual):** `{{ $json.labelIds.join(', ') }}`\n* **Cabe√ßalho Enviado Automaticamente:** `{{ $json.headers['auto-submitted'] }}`\n* **Cabe√ßalho do Remetente Original (se diferente de De):** `{{ $json.headers.sender }}`\n* **Cabe√ßalho em Resposta (para e-mail atual):** `{{ $json.headers['in-reply-to'] }}`\n* **Cabe√ßalho de Refer√™ncias (para o e-mail atual):** `{{ $json.headers.references }}`\n* **Cabe√ßalho de Lista de Cancelamento de Inscri√ß√£o:** `{{ $json.headers['list-unsubscribe'] }}`\n* **Cabe√ßalho de Preced√™ncia:** `{{ $json.headers.precedence }}` (e.g., \"Bulk\")\n\n**R√≥tulos, Descri√ß√µes e L√≥gica de Prioriza√ß√£o:**\n\n**Orienta√ß√µes Sobre Como Usar o Hist√≥rico de E-mail Anterior e Links de Cancelamento de Assinatura:**\n* **Hist√≥rico de E-mail Anterior = \"N√£o\":** Forte indicador de um **e-mail frio/n√£o solicitado**.\n    * Se for um discurso promocional/de vendas: Provavelmente \"Marketing\"\n. * Se for excepcionalmente personalizado e de alto valor para Trigify: Raramente \"responder√°..\"\n* **Hist√≥rico de E-mail Anterior = \"Sim\":** Indica um **relacionamento/conversa existente**.\n * Se for uma atualiza√ß√£o sobre termos, pol√≠ticas ou altera√ß√µes de servi√ßo desta entidade conhecida: Provavelmente \"Notifica√ß√£o.\"\n    * Se for um boletim informativo que Paulo assinou: Poderia ser \"FYI\" ou \"Marketing\" com base no conte√∫do.\n    * Se for uma mensagem direta que exige a√ß√£o: Provavelmente \"Para Responder\".\"\n* **Cabe√ßalho `Cancelar Inscri√ß√£o` ou links de cancelamento de inscri√ß√£o no corpo:**\n * Comum em e-mails de \"Marketing\".\n    * Tamb√©m presente em muitos e-mails leg√≠timos de \"Notifica√ß√£o\" (ex: atualiza√ß√µes de servi√ßo, mudan√ßas de pol√≠tica como o exemplo do DPA) e alguns boletins informativos \"FYI\" para conformidade.\n    * **Portanto, um link de cancelamento de assinatura por si s√≥ n√£o define a categoria. Considere-o juntamente com o Hist√≥rico de E-mails Anteriores e o conte√∫do/finalidade do e-mail.**\n* **Cabe√ßalho `Preced√™ncia: Em Massa`:** Geralmente indica envios em massa, comum para Marketing, Notifica√ß√µes e alguns Textos Informativas.\n\n---\n\n* **Para Responder (ID do R√≥tulo: `Label_5151750749488724401`):**\n    * **Crit√©rios prim√°rios:** Requer a√ß√£o/resposta direta e oportuna de `paulo.moreira.n8n@gmail.com`.\n    * **Indicadores-Chave (especialmente se o Hist√≥rico de E-mails Anteriores for \"Sim\"):** Perguntas diretas para Paulo, tarefas atribu√≠das, solicita√ß√µes de informa√ß√µes para o Trigify, prazos para Paulo, parte de uma conversa ativa (indicada por `Em resposta a`/`Refer√™ncias`).\n    * **Prioriza√ß√£o do Processo de Vendas (Leads Quentes/Processos Ativos - normalmente Hist√≥rico de E-mails Anteriores = \"Sim\"):** Discuss√µes cont√≠nuas e ativas sobre o processo de vendas do Trigify.\n    * **Vendas Frias de Alto Valor (Casos Excepcionais - Hist√≥rico de E-mails Anterior = \"N√£o\"):** Oportunidade estrat√©gica altamente personalizada para a Trigify, que exige a aten√ß√£o pessoal do Paulo. (O padr√£o para vendas frias √© \"Marketing\").\n\n* **Para sua informa√ß√£o (ID do R√≥tulo: `Label_7518716752151077752`):**\n    * **Crit√©rios Prim√°rios:** Para conhecimento de Paulo; nenhuma a√ß√£o/resposta imediata necess√°ria.\n    * **Principais Indicadores:**\n        * Paulo √© Copiado, a√ß√£o prim√°ria para outros.\n        * An√∫ncios gerais, boletins informativos *n√£o promocionais* de *entidades/assinaturas conhecidas* (Hist√≥rico de E-mail Anterior = \"Sim\" ou o remetente √© claramente uma fonte assinante) que n√£o s√£o notifica√ß√µes cr√≠ticas de servi√ßo.\n        * Atualiza√ß√µes informativas dentro de projetos em andamento onde Paulo n√£o √© o ator principal.\n    * Se um e-mail for um envio em massa (`Preced√™ncia: Em Massa`, `Lista-Cancelar Assinatura` presente) de uma *entidade conhecida* (Hist√≥rico de E-mails Anteriores = \"Sim\") e for puramente informativo, sem uma chamada direta para a√ß√£o ou atualiza√ß√£o cr√≠tica de servi√ßo, pode ser \"Para sua informa√ß√£o.\"\n\n* **Coment√°rio (ID do R√≥tulo: `Label_1470120230130814788`):**\n    * Coment√°rio/feedback sobre um documento, tarefa, sistema (ex:, Assunto \"Novo coment√°rio em...\").\n\n* **Notifica√ß√£o (ID do r√≥tulo: `Label_9`):**\n    * **Crit√©rios Principais:** Fornece atualiza√ß√µes ou alertas importantes, geralmente n√£o promocionais, sobre um servi√ßo, conta ou sistema existente que `paulo.moreira.n8n@gmail.com` ou o Trigify utiliza ou pelo qual √© afetado. A a√ß√£o normalmente consiste em conscientiza√ß√£o, poss√≠vel altera√ß√£o de configura√ß√£o ou anota√ß√£o de um prazo, em vez de uma resposta em tom de conversa..\n    * **Principais Indicadores:**\n        * **Atualiza√ß√µes de Provedores de Servi√ßos Conhecidos (Hist√≥rico de E-mail Anterior = \"Sim\" √© comum):**\n            * Altera√ß√µes nos Termos de Servi√ßo, Pol√≠ticas de Privacidade, Contratos de Processamento de Dados (CPDs como exemplo \"Simples\").\n            * An√∫ncios de disponibilidade de servi√ßos cr√≠ticos (interrup√ß√µes, manuten√ß√£o).\n            * Alertas de seguran√ßa relacionados a uma conta que Paulo usa.\n            * Atualiza√ß√µes importantes sobre recursos ou funcionalidades de um servi√ßo do qual o Trigify depende, que n√£o s√£o principalmente novos recursos de marketing.\n        * Alertas gerados pelo sistema (ex: `Cabe√ßalho Enviado Automaticamente` = `gerado automaticamente`), como notifica√ß√µes de m√≠dia social, lembretes de calend√°rio sem reuni√£o, alguns alertas de transa√ß√µes financeiras.\n        * As linhas de assunto podem conter: \"Atualiza√ß√£o importante\", \"Notifica√ß√£o de servi√ßo\", \"Altera√ß√£o de pol√≠tica\", \"Atualiza√ß√£o do CPD\", \"Alerta de seguran√ßa\".\n        * Mesmo que um link `Cancelar Insci√ß√£o na Lista` esteja presente (para conformidade), se o conte√∫do principal for uma atualiza√ß√£o cr√≠tica de servi√ßo/conta/legal de uma empresa com a qual a Paulo/Trigify faz neg√≥cios, √© uma \"Notifica√ß√£o\".\n        * Os `R√≥tulos Existentes do Gmail` podem incluir `ATUALIZA√á√ïES_DE_CATEGORIA`.\n\n* **Atualiza√ß√£o da Reuni√£o (ID do R√≥tulo: `Label_7958083858424702466`):**\n    * Atualiza√ß√£o especifica sobre uma reuni√£o agendada (por exemplo, \"Aceito:\", \"Recusado:\", \"Convite Atualizado:\", \"Cancelado:\").\n\n* **Marketing (ID do R√≥tulo: `Label_5274550748854913384`):**\n    * **Principais Crit√©rios:** Proposta de venda promocional n√£o solicitada, propaganda ou boletim informativo geral de marketing, especialmente se **Hist√≥rico de E-mail Anterior = \"N√£o\"**\n    * **Principais Indicadores:**\n        * **Nenhum hist√≥rico de e-mail anterior foi encontrado com o `E-mail do Remetente`,** E o e-mail tem como objetivo principal vender um produto/servi√ßo ou promover uma empresa/evento para Paulo/Trigify.\n        * O conte√∫do √© gen√©rico, focado em recursos/benef√≠cios sem forte personaliza√ß√£o dos projetos conhecidos e ativos de Paulo.\n        * Cont√©m um `Cabe√ßalho de Cancelamento de Inscri√ß√£o em Lista` E o conte√∫do √© promocional.\n        * `R√≥tulos Existentes do Gmail` podem incluir `CATEGORY_PROMOTIONS`.\n    * Se **Hist√≥rico de E-mail Anterior = \"Sim\"**: Ainda pode ser \"Marketing\" se for um boletim informativo/oferta claramente promocional de um contato conhecido que n√£o se enquadra em \"Notifica√ß√£o\" ou exige um \"Para responder\".\n\n---\n\n**Dados de E-mail para Classifica√ß√£o (resumo):**\n* **Hist√≥rico de E-mail Anterior com Remetente (Sim/N√£o) - Do novo recurso**\n* E-mail do Remetente: `{{ $json.from.value[0].address }}`\n* Nome do Remetente: `{{ $json.from.value[0].name }}`\n* E-mails de Destinat√°rios Diretos (Para): `{{ $json.to.value.map(r => r.address).join(', ') }}`\n* E-mails de Destinat√°rios CC: `{{ $json.cc.value.map(r => r.address).join(', ') }}`\n* Assunto: `{{ $json.subject }}`\n* Corpo (Texto Simples): `{{ $json.text }}`\n* Marcadores Existentes do Gmail: `{{ $json.labelIds.join(', ') }}`\n* Cabe√ßalho Enviado Automaticamente: `{{ $json.headers['auto-submitted'] }}`\n* Cabe√ßalho do Remetente Original: `{{ $json.headers.sender }}`\n* Cabe√ßalho em Resposta: `{{ $json.headers['in-reply-to'] }}`\n* Cabe√ßalho de Refer√™ncias: `{{ $json.headers.references }}`\n* Cabe√ßalho de Cancelamento de Inscri√ß√£o em Lista:`{{ $json.headers['list-unsubscribe'] }}`\n* Cabe√ßalho de Preced√™ncia: `{{ $json.headers.precedence }}`\n\n**Sa√≠da:** [Forne√ßa SOMENTE o ID do R√≥tulo aqui]"
        }
      },
      "id": "be7dfd12-a710-46b4-bfdf-4a69ade80002",
      "name": "AI Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        1380,
        300
      ],
      "typeVersion": 1.9
    },
    {
      "parameters": {
        "operation": "getAll",
        "returnAll": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Return_All', ``, 'boolean') }}",
        "filters": {
          "q": "=from:{{ $fromAI('email') }}"
        }
      },
      "id": "f9206507-8715-48d8-a64a-a1f6290408f5",
      "name": "Get Email",
      "type": "n8n-nodes-base.gmailTool",
      "position": [
        1640,
        600
      ],
      "webhookId": "c30886d9-3d98-464d-82b8-e7649c87610a",
      "typeVersion": 2.1,
      "credentials": {
        "gmailOAuth2": {
          "id": "2h2s2AVV8GDAHrDN",
          "name": "Autentica√ß√£o na API do Google Gmail"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "filters": {
          "labelIds": [
            "SENT"
          ],
          "q": "=to:{{ $fromAI('email') }}"
        }
      },
      "id": "77c76d0a-25e5-4de9-989f-9b8a72088319",
      "name": "Check Sent",
      "type": "n8n-nodes-base.gmailTool",
      "position": [
        1440,
        600
      ],
      "webhookId": "0854fad3-622e-44b4-9d61-5aae13c61433",
      "typeVersion": 2.1,
      "credentials": {
        "gmailOAuth2": {
          "id": "2h2s2AVV8GDAHrDN",
          "name": "Autentica√ß√£o na API do Google Gmail"
        }
      }
    },
    {
      "parameters": {
        "content": "## AI-Email Manager = Classifica√ß√£o Inteligente do Gmail By Max Mitcham\n\n#### Este fluxo de automa√ß√£o foi projetado para monitorar automaticamente as mensagens recebidas do Gmail, analisar seu conte√∫do e contexto usando IA e classific√°-las de forma inteligente com r√≥tulos apropriados para melhor organiza√ß√£o e prioriza√ß√£o de e-mails.\n\n### ‚öôÔ∏è Como funciona (passo a passo):\nüìß Monitoramento do Gmail (Gatilho)\n- Monitora continuamente sua caixa de entrada do Gmail:\n. Verifica novos e-mails a cada minuto\n. Captura todas as mensagens recebidas automaticamente\n. Aciona o Workflow para cada novo e-mail recebido\n\n### üìñ Extra√ß√£o de Conte√∫do de E-mail\n- Recupera detalhes completos do e-mail:\n. Corpo e cabe√ßalhos completos do e-mail\n. Informa√ß√µes do remetente e listas de destinat√°rios\n. Linha de assunto e metadados\n. R√≥tulos e categorias existentes do Gmail\n. Informa√ß√µes de encadeamento de e-mails (respostas/encaminhamentos)\n\n### üîç An√°lise do Hist√≥rico de E-mails\n- O agente de IA verifica o contexto do relacionamento:\n. Busca e-mails anteriores do mesmo remetente\n. Verifica a pasta de mensagens enviadas para correspond√™ncias enviadas anteriormente\n. Determina se este √© um primeiro contato (e-mail frio)\n. Analisa o hist√≥rico de conversas\n\n### ü§ñ Agente de Classifica√ß√£o Inteligente\n- Categoriza√ß√£o avan√ßada de IA usando:\n. Claude Sonnet 4 para an√°lise sofisticada de e-mails\n. Classifica√ß√£o contextual com base no hist√≥rico de e-mails\n. An√°lise de conte√∫do para detec√ß√£o de inten√ß√£o e urg√™ncia\n. Cabe√ßalho An√°lise para e-mails automatizados vs. enviados por humanos\n\n### üè∑Ô∏è Atribui√ß√£o de R√≥tulos Inteligentes\n- Aplica automaticamente os r√≥tulos apropriados do Gmail:\n. Para responder: Requer a√ß√£o/resposta direta\n. Para sua informa√ß√£o: Para conscientiza√ß√£o, nenhuma a√ß√£o necess√°ria\n. Notifica√ß√£o: Atualiza√ß√µes de servi√ßo, altera√ß√µes de pol√≠tica\n. Marketing: Conte√∫do promocional e argumentos de venda\n. Atualiza√ß√£o de reuni√£o: Comunica√ß√µes relacionadas ao calend√°rio\n. Coment√°rio: Feedback de documento/tarefa\n\n### üìã Processamento Estruturado\n- Garante a consist√™ncia dos r√≥tulos:\n. Usa an√°lise de sa√≠da estruturada para confiabilidade\n. Retorna um ID de r√≥tulo espec√≠fico para integra√ß√£o com o Gmail\n. Aplica o r√≥tulo automaticamente ao e-mail\n. Mant√©m a precis√£o da classifica√ß√£o\n\n### üõ†Ô∏è Ferramentas utilizadas:\n- n8n: Plataforma de automa√ß√£o de fluxo de trabalho\n- API do Gmail: Monitoramento de e-mail e gerenciamento de r√≥tulos\n- Anthropic Claude: An√°lise avan√ßada de conte√∫do de e-mail\n- Ferramentas do Gmail: Verifica√ß√£o e pesquisa do hist√≥rico de e-mail\n- Analisador de Sa√≠da Estruturada: Respostas consistentes de IA\n\n### üì¶ Principais recursos:\n- Monitoramento e classifica√ß√£o de e-mails em tempo real\n- An√°lise contextual usando o hist√≥rico de e-mails\n- Inteligente Detec√ß√£o de e-mails frios vs. mornos\n- V√°rias categorias de classifica√ß√£o para organiza√ß√£o\n- Aplica√ß√£o autom√°tica de r√≥tulos do Gmail\n- An√°lise de cabe√ßalho para detec√ß√£o automatizada de e-mails\n- Rastreamento de conversas com base em threads\n\n### üöÄ Casos de Uso Ideais:\n- Executivos ocupados gerenciando altos volumes de e-mails\n- Profissionais de vendas priorizando comunica√ß√µes com clientes em potencial\n- Equipes de suporte organizando consultas de clientes\n- Equipes de marketing filtrando conte√∫do promocional\n- Qualquer pessoa que queira organiza√ß√£o automatizada de e-mails\n- Equipes que precisam de prioriza√ß√£o consistente de e-mails",
        "height": 1740,
        "width": 680,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        0,
        0
      ],
      "typeVersion": 1,
      "id": "9219a7c8-750c-434a-963a-c786bfdc3265",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "operation": "get",
        "messageId": "={{ $json.id }}",
        "simple": false,
        "options": {}
      },
      "id": "fc87b0b6-e9b4-4afd-93b6-397d475cb394",
      "name": "Get a message",
      "type": "n8n-nodes-base.gmail",
      "position": [
        1080,
        300
      ],
      "webhookId": "01c91a6b-4d45-4630-8e81-0f82ee5d6524",
      "typeVersion": 2.1,
      "credentials": {
        "gmailOAuth2": {
          "id": "2h2s2AVV8GDAHrDN",
          "name": "Autentica√ß√£o na API do Google Gmail"
        }
      }
    },
    {
      "parameters": {
        "operation": "addLabels",
        "messageId": "={{ $('Get a message').item.json.id }}",
        "labelIds": "={{ $json.output['label ID'] }}"
      },
      "id": "efeb8402-0a98-4139-b5ee-a68afc2147ac",
      "name": "Add label to message",
      "type": "n8n-nodes-base.gmail",
      "position": [
        1900,
        300
      ],
      "webhookId": "575a4038-3b07-46b9-be69-39cfc1d47d7e",
      "typeVersion": 2.1,
      "credentials": {
        "gmailOAuth2": {
          "id": "2h2s2AVV8GDAHrDN",
          "name": "Autentica√ß√£o na API do Google Gmail"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "AI Agent": {
      "main": [
        [
          {
            "node": "Add label to message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Email": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Check Sent": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Gmail Trigger": {
      "main": [
        [
          {
            "node": "Get a message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Anthropic Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "AI Agent",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Get a message": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "6cdbde06-8ac3-4dc1-a7a7-513fd27045c6",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "f8fb8b7c9f227cabfd3532e55a910625bd5265edfac26d35ea7f1663405904ec"
  },
  "id": "gt29FWzk4JIUMOe3",
  "tags": [
    {
      "name": "Anthropic",
      "id": "ifi5pBESUuJGdJEy",
      "createdAt": "2025-07-02T13:39:52.810Z",
      "updatedAt": "2025-07-02T13:39:52.810Z"
    }
  ]
}